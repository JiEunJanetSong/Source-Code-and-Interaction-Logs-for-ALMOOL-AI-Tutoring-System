<!DOCTYPE html>
<meta charset="utf-8">
<html data-theme="light">
<head>
    <script src="https://www.desmos.com/api/v1.8/calculator.js?apiKey=dcb31709b452b1cf9dc26972add0fda6"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <meta charset="UTF-8">
    <link href="/dist/output.css" rel="stylesheet">
</head>

<style>
    body {
        font-size: 16px;
    }

    input {
        width: 240px;
        height: 35px;
        border: 1px solid gray;
        text-align: center;
        font-size: 20px;
    }

    select {
        width: 220px;
        height: 40px;
        font-size: 20px;
        text-align: center;
    }

    table {
        border: 1px solid #aaaaaa;
        text-align: center;
    }

    tr {
        height: 50px;
    }

    th {
        text-align: center;
        font-weight: bold;
        border: none;
    }

    td {
        text-align: center;
    }

    #subject,
    #value {
        background-color: rgba(120,82,232,0.2);
        font-size: 20px;
    }
    #rightValue {
        background-color: rgba(39, 235, 88, 0.2);
        font-size: 20px;
    }
    #errorValue {
        background-color: rgba(235, 39, 39, 0.2);
        font-size: 20px;
    }

    #showPrevProblem,
    #showNextProblem,
    #submitAnswer {
        font-size: 20px;
        font-weight: bold;
        width: 250px;
        height: 50px;
        cursor: pointer;
    }
</style>

<script>

let problemAnswer = Array(64);
let problemAnswerType = Array(64);  //0:객관식, 1:주관식
let problemNum = 25;
let nowProblemNumber = 1;
let startTime;
let showCalc = false;
let desmosCalculator = false;

problemAnswerType[0] = 0;
problemAnswerType[1] = 0;
problemAnswerType[2] = 0;
problemAnswerType[3] = 0;
problemAnswerType[4] = 0;
problemAnswerType[5] = 1;
problemAnswerType[6] = 1;
problemAnswerType[7] = 1;
problemAnswerType[8] = 1;
problemAnswerType[9] = 1;
problemAnswerType[10] = 1;
problemAnswerType[11] = 1;
problemAnswerType[12] = 1;
problemAnswerType[13] = 0;
problemAnswerType[14] = 0;
problemAnswerType[15] = 0;
problemAnswerType[16] = 0;
problemAnswerType[17] = 0;
problemAnswerType[18] = 0;
problemAnswerType[19] = 0;
problemAnswerType[20] = 0;
problemAnswerType[21] = 0;
problemAnswerType[22] = 0;
problemAnswerType[23] = 0;
problemAnswerType[24] = 0;
problemAnswerType[25] = 1;


for(let i=1;i<=problemNum;i++)
{
    problemAnswer[i] = "";
}

function showProblem()
{
    document.getElementById("problemShow").innerHTML = "<img src='" + nowProblemNumber + ".png'>";
    document.getElementById("answerShow").innerHTML = getAnswerInputCode(nowProblemNumber);

    if(problemAnswerType[nowProblemNumber] == 0)
        ;
    else
        document.getElementById("customerAnswer").value = problemAnswer[nowProblemNumber];
}

function getAnswerTalbeCode()
{
    let tableCode = "<table class='table' style='border:none;'>";
    tableCode += "<colgroup>";
    tableCode += "<col style='width: 30px;'>";
    tableCode += "<col style='width: 100px;'>";
    tableCode += "</colgroup>";
    tableCode += "<thead><tr>";
    tableCode += "<th colspan='2'>";
    tableCode += "My Answer";
    tableCode += "</th>";
    tableCode += "</tr></thead><tbody>";

    for(let i=1;i<=problemNum;i++)
    {
        tableCode += "<tr class='hover'><th>";
        tableCode += i;
        tableCode += "</th><th>";
        tableCode += "<input type='text' placeholder='Answer' class='input input-bordered input-accent input-xs w-full max-w-xs' style='width:100px;height:40px;' id='myAnswer" + i + "' value='" + problemAnswer[i] + "' oninput='syncAnswer2(this," + i + ")'/>";
        tableCode += "</th></tr>";
    }
    
    tableCode += "</tbody></table>";

    return tableCode;
}

function getAnswerInputCode(n)
{
    let answerCode = "";

    if(problemAnswerType[n] == 0)
    {
        answerCode += "<div class='form-control' style='height:50px;'>";
        answerCode += "<label class='label cursor-pointer'>";
        answerCode +=     "<span class='label-text' style='width: 200px;'>(A)</span> ";
        answerCode +=     "<input type='radio' onclick='syncAnswer1(this," + n + ")' name='answer-0' class='radio checked:bg-primary' " + ((problemAnswer[n]=="A") ? "checked" : "unchecked") + " />";
        answerCode += "</label>";
        answerCode += "</div>";
        answerCode += "<div class='form-control' style='height:50px;'>";
        answerCode += "<label class='label cursor-pointer'>";
        answerCode +=     "<span class='label-text' style='width: 200px;'>(B)</span> ";
        answerCode +=     "<input type='radio' onclick='syncAnswer1(this," + n + ")' name='answer-0' class='radio checked:bg-secondary' " + ((problemAnswer[n]=="B") ? "checked" : "unchecked") + " />";
        answerCode += "</label>";
        answerCode += "</div>";
        answerCode += "<div class='form-control' style='height:50px;'>";
        answerCode += "<label class='label cursor-pointer'>";
        answerCode +=     "<span class='label-text' style='width: 200px;'>(C)</span> ";
        answerCode +=     "<input type='radio' onclick='syncAnswer1(this," + n + ")' name='answer-0' class='radio checked:bg-accent' " + ((problemAnswer[n]=="C") ? "checked" : "unchecked") + " />";
        answerCode += "</label>";
        answerCode += "</div>";
        answerCode += "<div class='form-control' style='height:50px;'>";
        answerCode += "<label class='label cursor-pointer'>";
        answerCode +=     "<span class='label-text' style='width: 200px;'>(D)</span> ";
        answerCode +=     "<input type='radio' onclick='syncAnswer1(this," + n + ")' name='answer-0' class='radio checked:bg-info' " + ((problemAnswer[n]=="D") ? "checked" : "unchecked") + " />";
        answerCode += "</label>";
        answerCode += "</div>";
    }
    else
        answerCode = "<input type='text' placeholder='Answer' class='input input-bordered input-accent w-full max-w-xs' style='width:200px;' name='customerAnswer' id='customerAnswer' oninput='syncAnswer1(this," + n + ")'/>";

    return answerCode;
}

function getRadioCheckedIndex(name)
{
    let radio = document.getElementsByName(name);
    for(let i=0;i<radio.length;i++)
    {
        if(radio[i].checked)
            return i;
    }
    return -1;
}

//현재 문제의 정답을 입력하면 전체 정답 목록에 반영됨
function syncAnswer1(input,problemNum)
{
    if(problemAnswerType[problemNum] == 0)
    {
        let radioidx = getRadioCheckedIndex("answer-0");
        if(radioidx == 0) problemAnswer[nowProblemNumber] = "A";
        else if(radioidx == 1) problemAnswer[nowProblemNumber] = "B";
        else if(radioidx == 2) problemAnswer[nowProblemNumber] = "C";
        else if(radioidx == 3) problemAnswer[nowProblemNumber] = "D";
        else problemAnswer[nowProblemNumber] = "";

        document.getElementById("myAnswer" + problemNum).value = problemAnswer[nowProblemNumber];
    }
    else
    {
        document.getElementById("myAnswer" + problemNum).value = input.value;
        problemAnswer[problemNum] = input.value;
    }
}

//전체 정답 목록에서 정답을 수정하면 현재 정답에 반영됨
function syncAnswer2(input,problemNum)
{
    if(problemNum == nowProblemNumber)
    {
        if(problemAnswerType[problemNum] == 0)
        {
            for(let i=0;i<4;i++)
            {
                document.getElementsByName("answer-0")[0].checked = false;
            }

            let answerStr = input.value;
            if(answerStr == "A") document.getElementsByName("answer-0")[0].checked = true;
            else if(answerStr == "B") document.getElementsByName("answer-0")[1].checked = true;
            else if(answerStr == "C") document.getElementsByName("answer-0")[2].checked = true;
            else if(answerStr == "D") document.getElementsByName("answer-0")[3].checked = true;

            problemAnswer[nowProblemNumber] = input.value;
        }
        else
        {
            document.getElementById("customerAnswer").value = input.value;
            problemAnswer[problemNum] = input.value;
        }
    }
}

function toggleCalculator()
{
    if(showCalc == false)
    {
        let elt = document.getElementById('calculator');
        desmosCalculator = Desmos.GraphingCalculator(elt);

        showCalc = true;
    }
    else
    {
        desmosCalculator.destroy();
        showCalc = false;
    }
}

$(document).ready( function () {
startTime = new Date();
showProblem();

$('#submitAnswer').on('click', function(event) {
    if(problemAnswerType[nowProblemNumber] == 0)
    {
        let radioidx = getRadioCheckedIndex("answer-0");
        if(radioidx == 0) problemAnswer[nowProblemNumber] = "A";
        else if(radioidx == 1) problemAnswer[nowProblemNumber] = "B";
        else if(radioidx == 2) problemAnswer[nowProblemNumber] = "C";
        else if(radioidx == 3) problemAnswer[nowProblemNumber] = "D";
        else problemAnswer[nowProblemNumber] = "";
    }
    else
        problemAnswer[nowProblemNumber] = document.getElementById("customerAnswer").value;

    var fm = $('#answerForm')[0];
    var action_url = "answer_confirm.php";
    let answerString = "";

    for(let i=1;i<=problemNum;i++)
    {
        answerString += (i) + ":" + problemAnswer[i] + "\n";
    }

    var hiddenField = document.createElement("input");
    hiddenField.setAttribute("type", "hidden");
    hiddenField.setAttribute("name", "answer");
    hiddenField.setAttribute("value", answerString);
    fm.appendChild(hiddenField);

    fm.method = 'POST';
    fm.action = action_url;
    fm.submit();
}); 

$('#showPrevProblem').on('click', function(event) {
    if(problemAnswerType[nowProblemNumber] == 0)
    {
        let radioidx = getRadioCheckedIndex("answer-0");
        if(radioidx == 0) problemAnswer[nowProblemNumber] = "A";
        else if(radioidx == 1) problemAnswer[nowProblemNumber] = "B";
        else if(radioidx == 2) problemAnswer[nowProblemNumber] = "C";
        else if(radioidx == 3) problemAnswer[nowProblemNumber] = "D";
        else problemAnswer[nowProblemNumber] = "";
    }
    else
        problemAnswer[nowProblemNumber] = document.getElementById("customerAnswer").value;

    if(nowProblemNumber>1)
        nowProblemNumber--;
        
    showProblem();
    document.getElementById("myAnswer").innerHTML = getAnswerTalbeCode();
});

$('#showNextProblem').on('click', function(event) {
    if(problemAnswerType[nowProblemNumber] == 0)
    {
        let radioidx = getRadioCheckedIndex("answer-0");
        if(radioidx == 0) problemAnswer[nowProblemNumber] = "A";
        else if(radioidx == 1) problemAnswer[nowProblemNumber] = "B";
        else if(radioidx == 2) problemAnswer[nowProblemNumber] = "C";
        else if(radioidx == 3) problemAnswer[nowProblemNumber] = "D";
        else problemAnswer[nowProblemNumber] = "";
    }
    else
        problemAnswer[nowProblemNumber] = document.getElementById("customerAnswer").value;

    if(nowProblemNumber<problemNum)
        nowProblemNumber++;

    showProblem();
    document.getElementById("myAnswer").innerHTML = getAnswerTalbeCode();
});


setInterval(() => {
    let nowTime = new Date();
    let diffTime = nowTime.getTime() - startTime.getTime();
    let remineTime = (1800000 - diffTime) / 1000;
    let timeStr = Math.floor(remineTime/60) + ":" + Math.floor(remineTime%60+0.5);
    document.getElementById("timer").innerHTML = "<div>" + timeStr + "</div>";
}, 1000);

document.getElementById("myAnswer").innerHTML = getAnswerTalbeCode();

});




</script>

<body>
    <div class="navbar bg-base-100">
        <div class="navbar-start">
          <div class="dropdown">
            <label tabindex="0" class="btn btn-ghost btn-circle">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" /></svg>
            </label>
            <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52">
              <li><a>Homepage</a></li>
              <li><a>Portfolio</a></li>
              <li><a>About</a></li>
            </ul>
            
          </div>
          <div class="flex-1">
            <a class="btn btn-ghost normal-case text-xl">Research Team Digital SAT</a>
          </div>
        </div>
        
        <div class="navbar-center">
          <div id="timer">30:00</div>
        </div>
        <div class="navbar-end">
          <button class="btn btn-ghost btn-circle">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-book" viewBox="0 0 16 16"> <path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z"/> </svg>
          </button>
          <button class="btn btn-ghost btn-circle">
            <div class="indicator">
                <a href="javascript:toggleCalculator()"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calculator" viewBox="0 0 16 16"> <path d="M12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h8zM4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4z"/> <path d="M4 2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-2zm0 4a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-4z"/> </svg></a>
              <!--<span class="badge badge-xs badge-primary indicator-item"></span>-->
            </div>
          </button>
        </div>
      </div>




    <br>
<form id="answerForm" name="answerForm">
    <div class="flex justify-center">
    <div>
    <table class="table-auto" style="margin-left: 100px; margin-right: 100px;">
    <colgroup>
        <col style="width: 800px;">
        <col style="width: 300px;">
    </colgroup>
    <thead>
    <tr><th colspan="2">
        
    </th></tr>
    </thead>
    <tbody>
    <tr>
        <th>
            <div id="problemShow" style="height:450px;">
                222
            </div>
        </th>
        <td id="answerShow">
        </td>
    </tr>
    <tr>
        <th>
            <button type="button" id="showPrevProblem" class="btn btn-primary">Prev</button>
            <button type="button" id="showNextProblem" class="btn btn-secondary">Next</button>
        </th>
        <th>
            <button type="button" id="submitAnswer" class="btn btn-accent">Submit</button>
        </th>
    </tr>
    <tr>
        <th colspan="2">
            <a href="javascript:toggleCalculator()">Calculator</a>
            <div id="calculatorPos" style="display: flex; justify-content: center;padding: 20px;">
                <div id="calculator" style="width: 1000px; height: 600px; display: flex; justify-content: center;"></div>
            </div>
        </th>
    </tr>
    </tbody>
    </table>
    </div>
    <div id="myAnswer" style="width:200px;height:500px;overflow:auto;">
    </div>
</form> 


<!--
<div tabindex="0" class="collapse border border-base-300 bg-base-200"> 
    <div class="collapse-title text-xl font-medium">
    Calculator
    </div>
    <div  class="collapse-content">
     <div  id="calculator", style="width: 600px; height: 400px;"> 
        </div>
  </div>
</div>
</body>
-->


</html>